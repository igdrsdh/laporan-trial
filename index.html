<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Jaga IGD - RS Dian Husada</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .shift-header {
            color: white;
            padding: 12px 16px;
            border-radius: 0.75rem;
            margin-top: 20px;
            font-weight: 800;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: opacity 0.2s;
        }
        .shift-header:hover { opacity: 0.9; }
        .input-group label {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 4px;
        }
        .input-group input, .input-group textarea, .input-group select {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            width: 100%;
            background-color: white;
        }
        .input-group input:focus { border-color: #0ea5e9; outline: none; }
        .doctor-inputs { display: flex; gap: 8px; align-items: center; }
        
        /* Dark Mode Styles */
        .dark { background-color: #1e293b !important; color: #e2e8f0 !important; }
        .dark body { background-color: #1e293b !important; }
        .dark .bg-white { background-color: #334155 !important; }
        .dark input, .dark textarea, .dark select { background-color: #475569 !important; border-color: #64748b !important; color: #fff !important; }
        .dark .text-gray-800, .dark .text-gray-700 { color: #f1f5f9 !important; }
        .dark .bg-gray-100 { background-color: #1e293b !important; }
    </style>
</head>
<body class="p-4 md:p-8">
    
    <!-- Tombol Mode Gelap -->
    <button id="darkToggle" class="fixed top-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-xl shadow-lg z-50">ğŸŒ“ Mode Gelap</button>

    <div class="max-w-2xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-2xl">
        <!-- Header -->
        <div class="flex items-center gap-4 mb-6 border-b pb-4">
            <div class="w-14 h-14 md:w-20 md:h-20 bg-sky-100 rounded-full flex items-center justify-center text-3xl">ğŸ¥</div>
            <div>
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800">Laporan Jaga IGD</h1>
                <p class="text-gray-500 text-sm font-medium">RS Dian Husada</p>
            </div>
        </div>
    
        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-4 rounded-xl mb-6 text-center text-white shadow-md">
            <h2 class="text-xl font-bold">ğŸ‰ Selamat Tahun Baru 2026 ğŸ‰</h2>
            <p class="text-xs opacity-80">Versi 2.6.1</p>
        </div>
    
        <!-- Input Data Umum -->
        <div class="space-y-6 mb-8 border-b pb-6">
            <h2 class="text-xl font-semibold text-sky-600">ğŸ“… Data Umum</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="input-group">
                    <label>Hari & Tanggal</label>
                    <input type="text" id="inputDate" placeholder="Kamis, 01 Januari 2026">
                </div>
                <div class="input-group">
                    <label>Kota</label>
                    <input type="text" id="inputCity" value="Mojokerto" readonly class="bg-gray-100 cursor-default">
                </div>
            </div>
        </div>
        
        <!-- Shifts -->
        <div id="shifts-container" class="space-y-4">
            <!-- Pagi 1 -->
            <div class="shift-block" data-shift="Pagi1">
                <div class="shift-header cursor-pointer bg-slate-700" id="headerPagi1">ğŸŒŒ Dini Hari (00.00 - 07.00)</div>
                <div class="p-4 bg-slate-50 rounded-b-xl space-y-4 hidden dark:bg-slate-800/50" id="contentPagi1"></div>
            </div>
            <!-- Pagi 2 -->
            <div class="shift-block" data-shift="Pagi2">
                <div class="shift-header bg-amber-500 cursor-pointer" id="headerPagi2">ğŸŒ„ Pagi (07.00 - 14.00)</div>
                <div class="p-4 bg-amber-50 rounded-b-xl space-y-4 hidden dark:bg-amber-900/10" id="contentPagi2"></div>
            </div>
            <!-- Siang -->
            <div class="shift-block" data-shift="Siang">
                <div class="shift-header bg-orange-500 cursor-pointer" id="headerSiang">ğŸœï¸ Siang (14.00 - 21.00)</div>
                <div class="p-4 bg-orange-50 rounded-b-xl space-y-4 hidden dark:bg-orange-900/10" id="contentSiang"></div>
            </div>
            <!-- Malam -->
            <div class="shift-block" data-shift="Malam">
                <div class="shift-header bg-indigo-600 cursor-pointer" id="headerMalam">ğŸŒ  Malam (21.00 - 00.00)</div>
                <div class="p-4 bg-indigo-50 rounded-b-xl space-y-4 hidden dark:bg-indigo-900/10" id="contentMalam"></div>
            </div>
        </div>
        
        <!-- Output -->
        <div class="mt-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">ğŸ“ Laporan Siap Salin</h2>
            <textarea id="outputReport" class="w-full h-64 bg-gray-100 p-4 border rounded-xl font-mono text-xs md:text-sm" readonly></textarea>
            
            <div id="doctorWarning" class="mt-3 p-3 bg-red-100 border border-red-400 text-red-700 rounded-xl font-medium hidden">
                âš ï¸ Nama dokter belum diisi: <span id="missingList"></span>
            </div>
            
            <button id="copyBtn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 px-4 rounded-xl mt-3 transition shadow-lg disabled:opacity-50">ğŸ“‹ Salin Laporan</button>
            <button id="resetBtn" class="w-full bg-red-100 text-red-600 font-bold py-3 px-4 rounded-xl mt-8">ğŸ—‘ï¸ Reset Data</button>
        </div>
    </div>

    <script>
        // Konfigurasi GitHub untuk Update Otomatis
        const REPO_OWNER = "igdrsdh"; 
        const REPO_NAME = "laporan-trial";
        const BRANCH = "main";
        const CHECK_INTERVAL = 300000; // Cek setiap 5 menit

        async function checkForUpdates() {
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/commits/${BRANCH}`);
                if (!response.ok) return;
                
                const data = await response.json();
                const latestSha = data.sha;
                const localSha = localStorage.getItem('github_commit_sha');

                if (localSha && localSha !== latestSha) {
                    if (confirm("Pembaruan aplikasi versi terbaru ditemukan di GitHub!\n\nIngin memuat ulang sekarang? (Data input Anda akan tetap aman di memori lokal)")) {
                        localStorage.setItem('github_commit_sha', latestSha);
                        location.reload(true);
                    }
                } else {
                    localStorage.setItem('github_commit_sha', latestSha);
                }
            } catch (err) {
                console.error("Gagal memeriksa update:", err);
            }
        }

        const doctors = ["dr. Sukresno Tjahjo W., M.Kes", "dr. Felicia Putri Hartono", "dr. Syntia Desy Arisandi", "dr. Imam Fadli", "dr. Deo Sanjaya", "dr. Evva Mardiyana", "dr. Farah Shania", "dr. Ratna Dewi"];
        const shifts = ['Pagi1', 'Pagi2', 'Siang', 'Malam'];

        function buildUI() {
            shifts.forEach(s => {
                const container = document.getElementById(`content${s}`);
                container.innerHTML = `
                    <div class="input-group"><label>Nama Dokter</label>
                        <div class="doctor-inputs">
                            <select id="dr${s}"><option value="">-- Pilih --</option>${doctors.map(d => `<option value="${d}">${d}</option>`).join('')}</select>
                            <input type="text" id="drEx${s}" placeholder="(Pengganti)">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="input-group"><label>Pasien (Tot)</label><input type="text" id="tot${s}" disabled class="bg-gray-100"></div>
                        <div class="input-group"><label>MRS</label><input type="text" id="mrs${s}" disabled class="bg-gray-100"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 p-3 bg-white rounded-lg border text-xs dark:bg-slate-700">
                        <div class="col-span-2 font-bold opacity-50 uppercase">Puskesmas</div>
                        <input type="number" id="pkmRI${s}" value="0" placeholder="RI"> <input type="number" id="pkmRJ${s}" value="0" placeholder="RJ">
                        <div class="col-span-2 font-bold opacity-50 uppercase">Rujukan</div>
                        <input type="number" id="rujRI${s}" value="0"> <input type="number" id="rujRJ${s}" value="0">
                        <div class="col-span-2 font-bold opacity-50 uppercase">Lab</div>
                        <input type="number" id="labRI${s}" value="0"> <input type="number" id="labRJ${s}" value="0">
                        <div class="col-span-2 font-bold opacity-50 uppercase">Siaga Desa</div>
                        <input type="number" id="dsRI${s}" value="0"> <input type="number" id="dsRJ${s}" value="0">
                        <div class="col-span-2 font-bold opacity-50 uppercase">Sendiri</div>
                        <input type="number" id="sdRI${s}" value="0"> <input type="number" id="sdRJ${s}" value="0">
                    </div>
                    <div class="grid grid-cols-2 gap-2"><input type="number" id="bpjs${s}" placeholder="BPJS"> <input type="number" id="umum${s}" placeholder="Umum"></div>
                    <textarea id="bpjsK${s}" placeholder="Ket BPJS" rows="2"></textarea>
                    <textarea id="umumK${s}" placeholder="Ket Umum" rows="2"></textarea>
                    <textarea id="doa${s}" placeholder="Ket DOA" rows="1"></textarea>
                    <textarea id="die${s}" placeholder="Ket Meninggal" rows="1"></textarea>
                `;
            });
        }

        function generate() {
            let totalA = 0, totalM = 0;
            let summary = "";
            let details = "";
            let missing = [];

            shifts.forEach(s => {
                const dr = document.getElementById(`dr${s}`).value;
                const drEx = document.getElementById(`drEx${s}`).value;
                const fDr = dr ? (drEx ? `${dr} (${drEx})` : dr) : drEx;
                if (!fDr) missing.push(s);

                const get = (id) => Number(document.getElementById(id + s).value) || 0;
                const getS = (id) => document.getElementById(id + s).value || "-";

                const mrs = get('pkmRI') + get('rujRI') + get('labRI') + get('dsRI') + get('sdRI');
                const rj = get('pkmRJ') + get('rujRJ') + get('labRJ') + get('dsRJ') + get('sdRJ');
                const tot = mrs + rj;
                
                document.getElementById('tot'+s).value = tot;
                document.getElementById('mrs'+s).value = mrs;

                totalA += tot; totalM += mrs;
                const lbl = s.includes('Pagi1') ? 'DINI HARI' : s.includes('Pagi2') ? 'PAGI' : s.includes('Siang') ? 'SIANG' : 'MALAM';
                summary += `${lbl} : ${tot} px, MRS: ${mrs}\n`;

                details += `SHIFT ${lbl}\nDokter: ${fDr || '-'}\nTotal: ${tot} | MRS: ${mrs}\nBPJS: ${get('bpjs')} | Umum: ${get('umum')}\nRJ: ${rj}\n\n`;
            });

            document.getElementById('outputReport').value = `LAPORAN IGD ${getVal('inputCity')}\n${getVal('inputDate')}\n\nTOTAL: ${totalA} PX (MRS: ${totalM})\n${summary}\n\n${details}`;
            
            document.getElementById('doctorWarning').classList.toggle('hidden', missing.length === 0);
            document.getElementById('missingList').textContent = missing.join(', ');
            document.getElementById('copyBtn').disabled = missing.length > 0;
            save();
        }

        function save() {
            const data = {};
            document.querySelectorAll('input, select, textarea').forEach(el => { if(el.id && !el.disabled) data[el.id] = el.value; });
            localStorage.setItem('igd_data', JSON.stringify(data));
        }

        function load() {
            const saved = localStorage.getItem('igd_data');
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = data[id]; });
            }
        }

        const getVal = (id) => document.getElementById(id).value;

        window.onload = () => {
            buildUI();
            load();
            checkForUpdates();
            setInterval(checkForUpdates, CHECK_INTERVAL);

            shifts.forEach(s => {
                document.getElementById(`header${s}`).onclick = () => {
                    document.getElementById(`content${s}`).classList.toggle('hidden');
                };
            });

            document.querySelectorAll('input, select, textarea').forEach(el => el.oninput = generate);
            
            document.getElementById('copyBtn').onclick = () => {
                const t = document.getElementById('outputReport');
                t.select();
                document.execCommand('copy');
                alert("Laporan berhasil disalin!");
            };

            document.getElementById('darkToggle').onclick = () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('dark', document.documentElement.classList.contains('dark'));
            };
            if(localStorage.getItem('dark') === 'true') document.documentElement.classList.add('dark');

            generate();
        };
    </script>
</body>
</html>

